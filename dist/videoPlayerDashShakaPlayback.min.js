this.SliceMeNice=this.SliceMeNice||{},this.SliceMeNice.VideoPlayer=this.SliceMeNice.VideoPlayer||{},this.SliceMeNice.VideoPlayer.DashShakaPlayback=function(e,o){"use strict";var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};var t=function(){function t(){this.enabled=!1,this.variants=[]}return t.checkVariantMeetsRestrictions=function(e,t){var i=function(e,t,i){return t<=e&&e<=i},n=e.video;if(n&&n.width&&n.height){if(!i(n.width,t.minWidth||0,t.maxWidth||1/0))return!1;if(!i(n.height,t.minHeight||0,t.maxHeight||1/0))return!1;if(!i(n.width*n.height,t.minPixels||0,t.maxPixels||1/0))return!1}return!!i(e.bandwidth,t.minBandwidth||0,t.maxBandwidth||1/0)},t.prototype.chooseVariant=function(){if(!this.config||!this.config.restrictions)return null;var e=t.filterAndSortVariants(this.config.restrictions,this.variants);return this.variants.length&&!e.length&&(e=[(e=t.filterAndSortVariants({},this.variants))[0]]),e[0]||null},t.prototype.configure=function(e){this.config=e,this.enabled&&this.suggestVariant()},t.prototype.disable=function(){this.enabled=!1},t.prototype.enable=function(){this.enabled=!0},t.filterAndSortVariants=function(t,e){var i=this;return t&&(e=e.filter(function(e){return i.checkVariantMeetsRestrictions(e,t)})),e.sort(function(e,t){return t.bandwidth-e.bandwidth})},t.prototype.init=function(e){this.switch=e},t.prototype.segmentDownloaded=function(){this.enabled&&this.suggestVariant()},t.prototype.setVariants=function(e){this.variants=e},t.prototype.stop=function(){this.enabled=!1,this.switch=void 0,this.variants=[]},t.prototype.suggestVariant=function(){if(this.config){var e=this.chooseVariant();if(e&&this.switch)(!this.selectedVariant||e.id!==this.selectedVariant.id)&&this.switch(e,!0)}},t}(),i={mpd:["application/dash+xml"]},n=function(n){function r(e,t){var i=n.call(this,e,t)||this;return i.videoElement=e,i.playerOptions=t,i.onResize=i.onResize.bind(i),i}return function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(r,n),r.canPlay=function(e,t){return 0<o.MimeTypeUtilities.mimeTypesForUrl(e,i).length},r.prototype.attach=function(){var i=this;return new Promise(function(e,t){if(!r.dependencies||!r.dependencies.length)throw Error("DashShakaPlayback: Please add the path to Shaka using SliceMeNice.VideoPlayer.DashShakaPlayback.setDependencies()");o.AssetService.loadFiles(r.dependencies).then(function(){window.shaka.polyfill.installAll(),i.player=new window.shaka.Player(i.videoElement),i.player.configure(i.playerOptions.dashShakaPlayback||{}),i.onResize(),window.addEventListener("resize",i.onResize),window.addEventListener("orientationchange",i.onResize),e()}).catch(function(e){throw e})})},r.prototype.detach=function(){return window.removeEventListener("resize",this.onResize),window.removeEventListener("orientationchange",this.onResize),this.player?this.player.destroy():Promise.resolve()},r.prototype.setSource=function(e){var t=this;return this.attach().then(function(){return t.player?t.player.load(e):Promise.resolve()})},r.setDependencies=function(e){r.dependencies=e},r.prototype.onResize=function(){var e=this,t=window.devicePixelRatio||1;e.player&&e.player.configure({abr:{restrictions:{maxWidth:e.videoElement.offsetWidth*t,maxHeight:e.videoElement.offsetHeight*t}}})},r.dependencies=[],r}(o.Playback);return e.DASH_MIMETYPES=i,e.Plugin=n,e.VideoSizeBasedABR=t,e}({},SliceMeNice.VideoPlayer);
